generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model agent_stats {
  id                  Int?
  agent_name          String?   @db.VarChar(255)
  allocated_extension String?   @db.VarChar(255)
  total_calls         String?   @db.VarChar(255)
  date                DateTime? @db.Date
  total_call_time     String?   @db.VarChar(255)
  call_time           String?   @db.VarChar(255)
  idle_time           String?   @db.VarChar(255)
  break_time          String?   @db.VarChar(255)
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  updated_at          DateTime? @default(now()) @db.Timestamp(6)

  @@ignore
}

model calls {
  id               BigInt        @id @default(autoincrement())
  campaign_name    String?       @db.VarChar(255)
  useremail        String?       @db.VarChar(255)
  username         String?       @db.VarChar(255)
  unique_id        String?       @db.VarChar(255)
  start_time       DateTime      @default(now()) @db.Timestamp(0)
  answer_time      DateTime?     @db.Timestamp(0)
  end_time         DateTime?     @db.Timestamp(0)
  call_duration    Int?
  billed_duration  Int?
  source           String?       @db.VarChar(255)
  extension        String?       @db.VarChar(255)
  region           String?       @db.VarChar(255)
  charges          Decimal?      @db.Decimal(10, 2)
  direction        String?       @db.VarChar(255)
  destination      String?       @db.VarChar(255)
  disposition      String?       @db.VarChar(255)
  platform         String?       @db.VarChar(255)
  recording_url    String?       @db.VarChar(2000)
  call_type        String?       @db.VarChar(255)
  remarks          String?       @db.VarChar(22)
  prospect_name    String?       @db.VarChar(55)
  prospect_email   String?       @db.VarChar(55)
  prospect_company String?       @db.VarChar(100)
  job_title        String?       @db.VarChar(55)
  job_level        String?       @db.VarChar(255)
  data_source_type String?       @db.VarChar(255)
  created_at       DateTime      @default(now()) @db.Timestamp(0)
  updated_at       DateTime      @default(now()) @db.Timestamp(0)
  notes            notes[]
  transcripts      transcripts[]
}

model campaigns {
  id            Int       @id @default(autoincrement())
  campaign_id   Int?
  campaign_name String?   @db.VarChar(255)
  start_date    DateTime? @db.DateTime(6)
  end_date      DateTime? @db.DateTime(6)
  allocations   String?   @db.VarChar(255)
  assigned_to   String?   @db.VarChar(255)
  status        String?   @db.VarChar(255)
  method        String?   @db.VarChar(255)
  created_at    DateTime? @db.Timestamp(6)
  updated_at    DateTime? @db.Timestamp(6)
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model extensions {
  id           Int?
  extension_id String?  @db.VarChar(255)
  password     String?  @db.VarChar(255)
  created_at   DateTime @default(now()) @db.Timestamp(0)
  updated_at   DateTime @default(now()) @db.Timestamp(0)

  @@ignore
}

model users {
  id                    Int                     @id @default(autoincrement())
  role                  String?                 @db.VarChar(255)
  unique_user_id        String?                 @unique(map: "unique_user_name") @db.VarChar(255)
  username              String?                 @db.VarChar(255)
  usermail              String?                 @db.VarChar(255)
  password              String?                 @db.VarChar(255)
  extension             String?                 @db.VarChar(255)
  status                String?                 @db.VarChar(255)
  created_at            DateTime?               @db.Timestamp(6)
  updated_at            DateTime?               @db.Timestamp(6)
  agent_breaks          agent_breaks[]
  agent_heartbeats      agent_heartbeats[]
  agent_presence_events agent_presence_events[]
  agent_sessions        agent_sessions[]
  document_shares       document_shares[]
  documents             documents[]
  notes                 notes[]
}

model transcripts {
  id         BigInt   @id @default(autoincrement())
  call_id    BigInt
  ts         DateTime @default(now()) @db.Timestamp(0)
  speaker    String   @db.VarChar(32)
  text       String   @db.VarChar(2000)
  sentiment  String?  @db.VarChar(32)
  confidence Float?
  calls      calls    @relation(fields: [call_id], references: [id], onDelete: Cascade)

  @@index([call_id, ts])
}

model agentic_campaigns {
  id           Int      @id @default(autoincrement())
  module       String   @unique @db.VarChar(255)
  name         String   @db.VarChar(255)
  agent_text   String   @db.Text
  session_text String   @db.Text
  created_at   DateTime @default(now()) @db.Timestamp(0)
  updated_at   DateTime @default(now()) @db.Timestamp(0)
}

model agentic_csv_files {
  id         Int      @id @default(autoincrement())
  name       String   @unique @db.VarChar(255)
  size       Int
  mtime      BigInt
  active     Boolean  @default(false)
  created_at DateTime @default(now()) @db.Timestamp(0)
  updated_at DateTime @default(now()) @db.Timestamp(0)
}

model dialing_contacts {
  id             BigInt                  @id @default(autoincrement())
  campaign_id    BigInt?
  csv_name       String?                 @db.VarChar(255)
  phone          String                  @db.VarChar(64)
  name           String?                 @db.VarChar(255)
  email          String?                 @db.VarChar(255)
  company        String?                 @db.VarChar(255)
  job_title      String?                 @db.VarChar(255)
  job_level      String?                 @db.VarChar(64)
  region         String?                 @db.VarChar(64)
  remarks        String?                 @db.Text
  priority       Int?                    @default(0)
  timezone       String?                 @db.VarChar(64)
  consent        Boolean?
  status         dialing_contacts_status @default(PENDING)
  attempts       Int                     @default(0)
  last_called_at DateTime?               @db.DateTime(0)
  created_at     DateTime                @default(now()) @db.DateTime(0)
  updated_at     DateTime                @default(now()) @db.DateTime(0)
}

model document_shares {
  document_id Int
  user_id     Int
  can_view    Boolean   @default(true)
  can_edit    Boolean   @default(false)
  shared_at   DateTime  @default(now()) @db.Timestamp(0)
  documents   documents @relation(fields: [document_id], references: [id], onDelete: Cascade, map: "fk_doc_shares_document")
  users       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_doc_shares_user")

  @@id([document_id, user_id])
  @@index([user_id], map: "idx_doc_shares_user")
}

model documents {
  id               Int                  @id @default(autoincrement())
  type             documents_type       @default(guide)
  title            String               @db.VarChar(255)
  description      String               @db.Text
  file_url         String?              @db.VarChar(2000)
  file_mime        String?              @db.VarChar(255)
  file_size_bytes  BigInt?
  content_richtext String?              @db.LongText
  version          Int                  @default(1)
  tags_csv         String               @default("") @db.VarChar(500)
  created_by       Int
  visibility       documents_visibility @default(org)
  created_at       DateTime             @default(now()) @db.Timestamp(0)
  updated_at       DateTime             @default(now()) @db.Timestamp(0)
  document_shares  document_shares[]
  users            users                @relation(fields: [created_by], references: [id], map: "fk_documents_user")

  @@index([created_by], map: "idx_documents_created_by")
  @@index([type], map: "idx_documents_type")
  @@index([visibility], map: "idx_documents_visibility")
}

model notes {
  id         Int              @id @default(autoincrement())
  user_id    Int
  call_id    BigInt?
  phone_e164 String           @default("") @db.VarChar(32)
  title      String           @db.VarChar(255)
  body       String           @db.Text
  tags_csv   String           @default("") @db.VarChar(500)
  visibility notes_visibility @default(private)
  created_at DateTime         @default(now()) @db.Timestamp(0)
  updated_at DateTime         @default(now()) @db.Timestamp(0)
  calls      calls?           @relation(fields: [call_id], references: [id], map: "fk_notes_call")
  users      users            @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_notes_user")

  @@index([call_id], map: "idx_notes_call_id")
  @@index([phone_e164], map: "idx_notes_phone")
  @@index([user_id, created_at], map: "idx_notes_user_created")
}

model agent_breaks {
  id              BigInt                 @id @default(autoincrement())
  user_id         Int
  session_id      BigInt
  break_reason_id Int?
  start_at        DateTime               @default(now()) @db.DateTime(6)
  end_at          DateTime?              @db.DateTime(6)
  ended_by        agent_breaks_ended_by?
  break_reasons   break_reasons?         @relation(fields: [break_reason_id], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "fk_breaks_reason")
  agent_sessions  agent_sessions         @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_breaks_session")
  users           users                  @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_breaks_user")

  @@index([break_reason_id], map: "fk_breaks_reason")
  @@index([session_id], map: "idx_breaks_session")
  @@index([start_at, end_at], map: "idx_breaks_time")
  @@index([user_id, session_id], map: "idx_breaks_user_session")
}

model agent_heartbeats {
  id             BigInt         @id @default(autoincrement())
  user_id        Int
  session_id     BigInt
  ts             DateTime       @default(now()) @db.DateTime(6)
  client_state   String?        @db.LongText
  ip             String?        @db.VarChar(45)
  agent_sessions agent_sessions @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_heartbeats_session")
  users          users          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_heartbeats_user")

  @@index([session_id, ts], map: "idx_heartbeats_session_ts")
  @@index([user_id, ts], map: "idx_heartbeats_user_ts")
}

model agent_presence_events {
  id             BigInt                             @id @default(autoincrement())
  user_id        Int
  session_id     BigInt
  event_type     agent_presence_events_event_type
  from_status    agent_presence_events_from_status?
  to_status      agent_presence_events_to_status?
  ts             DateTime                           @default(now()) @db.DateTime(6)
  meta           String?                            @db.LongText
  agent_sessions agent_sessions                     @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_presence_events_session")
  users          users                              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_presence_events_user")

  @@index([session_id, ts], map: "idx_presence_session_ts")
  @@index([event_type, ts], map: "idx_presence_type_ts")
  @@index([user_id, ts], map: "idx_presence_user_ts")
}

model agent_sessions {
  id                    BigInt                        @id @default(autoincrement())
  user_id               Int
  login_at              DateTime                      @default(now()) @db.DateTime(6)
  logout_at             DateTime?                     @db.DateTime(6)
  last_activity_at      DateTime                      @default(now()) @db.DateTime(6)
  login_ip              String?                       @db.VarChar(45)
  user_agent            String?                       @db.VarChar(255)
  ended_by              agent_sessions_ended_by?
  end_reason            String?                       @db.VarChar(255)
  is_active             Boolean                       @default(true)
  initial_status        agent_sessions_initial_status @default(AVAILABLE)
  agent_breaks          agent_breaks[]
  agent_heartbeats      agent_heartbeats[]
  agent_presence_events agent_presence_events[]
  users                 users                         @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_agent_sessions_user")

  @@index([is_active], map: "idx_agent_sessions_active")
  @@index([last_activity_at], map: "idx_agent_sessions_last_activity")
  @@index([user_id, is_active], map: "idx_agent_sessions_user_active")
}

model break_reasons {
  id           Int            @id @default(autoincrement())
  code         String         @unique(map: "code") @db.VarChar(64)
  label        String         @db.VarChar(255)
  active       Boolean        @default(true)
  created_at   DateTime       @default(now()) @db.DateTime(6)
  updated_at   DateTime       @default(now()) @db.DateTime(6)
  agent_breaks agent_breaks[]
}

enum documents_type {
  template
  guide
  playbook
  snippet
  other
}

enum notes_visibility {
  private
  team
  public
}

enum documents_visibility {
  private
  org
  public
}

enum dialing_contacts_status {
  PENDING
  CALLING
  ANSWERED
  BUSY
  NO_ANSWER
  FAILED
  COMPLETED
  SKIPPED
}

enum agent_presence_events_event_type {
  LOGIN
  LOGOUT
  STATUS_CHANGE
  BREAK_START
  BREAK_END
  HEARTBEAT
  IDLE_AUTO
}

enum agent_presence_events_from_status {
  OFFLINE
  AVAILABLE
  ON_CALL
  IDLE
  BREAK
}

enum agent_presence_events_to_status {
  OFFLINE
  AVAILABLE
  ON_CALL
  IDLE
  BREAK
}

enum agent_breaks_ended_by {
  system
  user
}

enum agent_sessions_ended_by {
  system
  user
}

enum agent_sessions_initial_status {
  OFFLINE
  AVAILABLE
  ON_CALL
  IDLE
  BREAK
}
