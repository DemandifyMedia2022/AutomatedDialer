{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/AutomatedDialer/apps/frontend/src/app/dashboard/agent/components/ManualDialer.tsx"],"sourcesContent":["\"use client\"\nimport React, { useState, useEffect, useRef } from \"react\";\n\nconst SIP_DOMAIN = \"pbx2.telxio.com.sg\";\n\nconst Dialer: React.FC = () => {\n  const [JsSIP, setJsSIP] = useState<any>(null);\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [number, setNumber] = useState(\"\");\n  const [ua, setUa] = useState<any>(null);\n  const [session, setSession] = useState<any>(null);\n  const [status, setStatus] = useState(\"Waiting for login...\");\n  const [isRegistered, setIsRegistered] = useState(false);\n  const [isCalling, setIsCalling] = useState(false);\n\n  const localAudioRef = useRef<HTMLAudioElement>(null);\n  const remoteAudioRef = useRef<HTMLAudioElement>(null);\n\n  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Load JsSIP dynamically ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  useEffect(() => {\n    const loadJsSIP = async () => {\n      const module = await import(\"jssip\");\n      setJsSIP(module.default);\n    };\n    loadJsSIP();\n  }, []);\n\n  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LOGIN HANDLER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  const handleLogin = async () => {\n    if (!username || !password) return alert(\"Enter SIP username and password\");\n    if (!JsSIP) return alert(\"JsSIP not yet loaded. Please wait a moment.\");\n\n    try {\n      const socket = new JsSIP.WebSocketInterface(`wss://${SIP_DOMAIN}:8089/ws`);\n      const configuration = {\n        sockets: [socket],\n        uri: `sip:${username}@${SIP_DOMAIN}`,\n        authorization_user: username,\n        password,\n        register: true,\n        display_name: username,\n      } as any;\n\n      const userAgent = new JsSIP.UA(configuration);\n      userAgent.start();\n\n      userAgent.on(\"connected\", () => setStatus(\"Connected\"));\n      userAgent.on(\"disconnected\", () => {\n        setStatus(\"Disconnected\");\n        setIsRegistered(false);\n      });\n      userAgent.on(\"registered\", () => {\n        setStatus(\"Registered ‚úÖ\");\n        setIsRegistered(true);\n        setIsLoggedIn(true);\n      });\n      userAgent.on(\"registrationFailed\", () => {\n        setStatus(\"Registration failed ‚ùå\");\n        setIsRegistered(false);\n      });\n\n      setUa(userAgent);\n    } catch (err) {\n      console.error(\"SIP configuration error\", err);\n      setStatus(\"SIP configuration error\");\n    }\n  };\n\n  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MAKE CALL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  const makeCall = async () => {\n    if (!number) return alert(\"Enter number\");\n    if (!ua) return alert(\"UA not initialized\");\n    if (!isRegistered) return alert(\"SIP not registered yet\");\n\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      if (localAudioRef.current) {\n        localAudioRef.current.srcObject = stream;\n      }\n\n      const callSession = ua.call(`sip:${number}@${SIP_DOMAIN}`, {\n        mediaConstraints: { audio: true, video: false },\n        mediaStream: stream,\n      });\n\n      callSession.connection.addEventListener(\"track\", (event: any) => {\n        if (remoteAudioRef.current) {\n          remoteAudioRef.current.srcObject = event.streams[0];\n        }\n      });\n\n      callSession.on(\"progress\", () => setStatus(\"Ringing...\"));\n      callSession.on(\"confirmed\", () => {\n        setStatus(\"In Call...\");\n        setIsCalling(true);\n      });\n      callSession.on(\"ended\", () => {\n        setStatus(\"Call Ended\");\n        setIsCalling(false);\n        setNumber(\"\");\n      });\n      callSession.on(\"failed\", () => {\n        setStatus(\"Call Failed ‚ùå\");\n        setIsCalling(false);\n      });\n\n      setSession(callSession);\n    } catch (err) {\n      console.error(\"Audio device error:\", err);\n      alert(\"Microphone access denied or unavailable.\");\n    }\n  };\n\n  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ END CALL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  const endCall = () => {\n    if (session) {\n      session.terminate();\n      setStatus(\"Call Ended\");\n      setIsCalling(false);\n    }\n  };\n\n  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LOGOUT HANDLER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  const handleLogout = () => {\n    if (ua) ua.stop();\n    setUa(null);\n    setIsLoggedIn(false);\n    setIsRegistered(false);\n    setUsername(\"\");\n    setPassword(\"\");\n    setNumber(\"\");\n    setStatus(\"Logged out\");\n  };\n\n  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ UI RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  if (!isLoggedIn) {\n    return (\n      <div className=\"flex min-h-[60vh] items-center justify-center\">\n        <div className=\"w-full max-w-sm rounded-lg border bg-card p-6 shadow-sm\">\n          <h2 className=\"mb-4 text-center text-xl font-semibold\">üîê SIP Login</h2>\n          <div className=\"space-y-3\">\n            <input\n              className=\"w-full rounded-md border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-primary\"\n              type=\"text\"\n              placeholder=\"SIP Username\"\n              value={username}\n              onChange={(e) => setUsername(e.target.value)}\n            />\n            <input\n              className=\"w-full rounded-md border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-primary\"\n              type=\"password\"\n              placeholder=\"SIP Password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n            />\n            <button className=\"w-full rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground hover:opacity-90\" onClick={handleLogin}>Login</button>\n            <p className=\"text-muted-foreground text-xs\">{status}</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"mx-auto w-full max-w-lg space-y-4\">\n      <div className=\"flex items-center justify-between rounded-lg border bg-card p-3 text-sm\">\n        <div className=\"font-medium\">{status}</div>\n        <button className=\"rounded-md border px-3 py-1 text-xs hover:bg-muted\" onClick={handleLogout}>\n          Logout\n        </button>\n      </div>\n\n      <input\n        className=\"w-full rounded-md border bg-background px-3 py-3 text-lg tracking-widest outline-none focus:ring-2 focus:ring-primary\"\n        type=\"text\"\n        value={number}\n        onChange={(e) => setNumber(e.target.value)}\n        placeholder=\"Enter number\"\n        disabled={isCalling}\n      />\n\n      <div className=\"grid grid-cols-3 gap-3\">\n        {[\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"*\", \"0\", \"#\"].map(\n          (num) => (\n            <button\n              key={num}\n              onClick={() => setNumber((prev) => prev + num)}\n              className=\"rounded-lg bg-muted py-4 text-lg font-semibold hover:opacity-90\"\n            >\n              {num}\n            </button>\n          )\n        )}\n      </div>\n\n      <div className=\"flex justify-center\">\n        {!isCalling ? (\n          <button\n            className=\"rounded-full bg-green-600 px-6 py-3 text-white hover:bg-green-700 disabled:opacity-50\"\n            onClick={makeCall}\n            disabled={!isRegistered}\r\n          >\r\n            üìû Call\r\n          </button>\r\n        ) : (\r\n          <button className=\"rounded-full bg-red-600 px-6 py-3 text-white hover:bg-red-700\" onClick={endCall}>\r\n            üî¥ End\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      <audio ref={localAudioRef} autoPlay muted />\r\n      <audio ref={remoteAudioRef} autoPlay />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Dialer;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}